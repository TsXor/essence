(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var o in e)t.o(e,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:e[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{extend:()=>B});const e=flarum.core.compat["forum/app"];var o=t.n(e);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["common/models/Discussion"];var r=t.n(a);const i=flarum.core.compat["common/components/Badge"];var c=t.n(i);const u=flarum.core.compat["forum/utils/DiscussionControls"];var l=t.n(u);const f=flarum.core.compat["forum/components/DiscussionPage"];var p=t.n(f);const d=flarum.core.compat["common/components/Button"];var v=t.n(d);const y=flarum.core.compat["forum/states/DiscussionListState"];var _=t.n(y);const b=flarum.core.compat["forum/components/DiscussionListItem"];var h=t.n(b);const E=flarum.core.compat["forum/components/IndexPage"];var P=t.n(E);const x=flarum.core.compat["common/utils/string"],S=flarum.core.compat["common/utils/classList"];var g=t.n(S);const O=flarum.core.compat["common/helpers/humanTime"];var D=t.n(O);const j=flarum.core.compat["forum/components/DiscussionHero"];var A=t.n(j);const M=flarum.core.compat["common/extenders"];var w=t.n(M);const I=flarum.core.compat["common/Model"];var L=t.n(I);function N(t,s){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},N(t,s)}const T=flarum.core.compat["forum/components/EventPost"];var q=function(t){var s,e;function o(){return t.apply(this,arguments)||this}e=t,(s=o).prototype=Object.create(e.prototype),s.prototype.constructor=s,N(s,e);var n=o.prototype;return n.icon=function(){return"fas fa-star"},n.descriptionKey=function(){return this.attrs.post.content().essential?"flarum-essence.forum.post_stream.discussion_set_essential_text":"flarum-essence.forum.post_stream.discussion_unset_essential_text"},o}(t.n(T)());const B=[(new(w().PostTypes)).add("discussionSetEssential",q),new(w().Model)(r()).attribute("isEssential").attribute("lastSetEssentialAt",L().transformDate).attribute("canSetEssential")];o().initializers.add("flarum-essence",(function(){(0,n.extend)(r().prototype,"badges",(function(t){this.isEssential()&&t.add("essential",m(c(),{type:"essential",label:o().translator.trans("flarum-essence.forum.badge.essential_tooltip"),icon:"fas fa-star"}),10)})),(0,n.extend)(l(),"moderationControls",(function(t,s){if(s.canSetEssential()){var e=s.isEssential()?"unset":"set";t.add("essence",m(v(),{icon:"fas fa-star",onclick:this.filpEssentialStatusAction.bind(s)},o().translator.trans("flarum-essence.forum.discussion_controls."+e+"_essential_button")))}})),l().filpEssentialStatusAction=function(){this.save({isEssential:!this.isEssential()}).then((function(){o().current.matches(p())&&o().current.get("stream").update(),m.redraw()}))},(0,n.extend)(_().prototype,"requestParams",(function(t){(o().current.matches(P())||o().current.matches(p()))&&t.include.push("firstPost")})),(0,n.extend)(h().prototype,"infoItems",(function(t){var s=this.attrs.discussion;if(s.isEssential()&&!this.attrs.params.q&&!s.lastReadPostNumber()){var e=s.firstPost();if(e){var o=(0,x.truncate)(e.contentPlain(),175);t.add("excerpt",m("div",null,o),-100)}}})),(0,n.extend)(h().prototype,"elementAttrs",(function(t){this.attrs.discussion.isEssential()&&(t.className=g()(t.className,"DiscussionListItem--essential"))})),(0,n.extend)(A().prototype,"items",(function(t){if(this.attrs.discussion.isEssential()){var s=this.attrs.discussion.lastSetEssentialAt();t.add("essential-date",m("span",{className:"DiscussionHero-essential-date"},o().translator.trans("flarum-essence.forum.discussion_hero.essential_date",{time:D()(s)})),-1)}}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map